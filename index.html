<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Am A Toy - È©¨Âπ¥ÁÉüËä±</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0015; overflow: hidden; cursor: crosshair; }
        canvas { display: block; }

        .couplet {
            position: fixed;
            writing-mode: vertical-rl;
            font-family: 'KaiTi', 'STKaiti', 'SimSun', serif;
            font-size: 2.2em;
            color: #ffd700;
            background: linear-gradient(180deg, #cc0000 0%, #880000 100%);
            padding: 20px 14px;
            border: 2.5px solid #ffd700;
            border-radius: 8px;
            z-index: 10;
            pointer-events: none;
            opacity: 0.7;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.6);
            letter-spacing: 0.2em;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.4), inset 0 0 15px rgba(255, 215, 0, 0.1);
        }
        .couplet-left { left: 20px; top: 50%; transform: translateY(-50%); }
        .couplet-right { right: 20px; top: 50%; transform: translateY(-50%); }

        #Ê®™Êâπ {
            position: fixed;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'KaiTi', 'STKaiti', 'SimSun', serif;
            font-size: 2.4em;
            color: #ffd700;
            background: linear-gradient(90deg, #cc0000, #880000);
            padding: 12px 40px;
            border: 2.5px solid #ffd700;
            border-radius: 8px;
            z-index: 10;
            pointer-events: none;
            opacity: 0.7;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.6);
            letter-spacing: 0.4em;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
        }

        #music-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 20;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.25);
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.5em;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            backdrop-filter: blur(4px);
        }
        #music-btn:hover { background: rgba(255,255,255,0.2); color: #fff; }

        #hint {
            position: fixed;
            bottom: 20px;
            left: 0; right: 70px;
            text-align: center;
            font-family: 'Microsoft YaHei', sans-serif;
            font-size: 0.8em;
            color: rgba(255,255,255,0.12);
            pointer-events: none;
            z-index: 10;
        }

        @media (max-width: 768px) {
            .couplet { font-size: 1.4em; padding: 14px 10px; }
            .couplet-left { left: 8px; }
            .couplet-right { right: 8px; }
            #Ê®™Êâπ { font-size: 1.5em; padding: 8px 24px; }
        }
        @media (max-width: 480px) {
            .couplet { font-size: 1.1em; padding: 10px 8px; }
            #Ê®™Êâπ { font-size: 1.2em; padding: 6px 16px; }
        }
    </style>
</head>
<body>
    <div class="couplet couplet-left">È™èÈ©¨Â•îËÖæËøéÊñ∞Â≤Å</div>
    <div class="couplet couplet-right">Êò•È£éÈÄÅÊöñÂÖ•‰∏áÂÆ∂</div>
    <div id="Ê®™Êâπ">È©¨Âπ¥Â§ßÂêâ</div>
    <button id="music-btn" title="Êí≠Êîæ/ÊöÇÂÅúÈü≥‰πê">üîá</button>
    <div id="hint">ÁÇπÂáª‰ªªÊÑè‰ΩçÁΩÆÊîæÁÉüËä±</div>
    <canvas id="c"></canvas>

    <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    const resize = () => { canvas.width = innerWidth; canvas.height = innerHeight; };
    resize();
    addEventListener('resize', resize);

    // ‚îÄ‚îÄ Utilities ‚îÄ‚îÄ
    const rand = (a, b) => Math.random() * (b - a) + a;
    const pick = arr => arr[Math.floor(Math.random() * arr.length)];

    // ‚îÄ‚îÄ Color palettes ‚îÄ‚îÄ
    const palettes = [
        ['#ff0040', '#ff355e', '#ff6b6b'],
        ['#ff8c00', '#ffa500', '#ffd700'],
        ['#00ff87', '#00e676', '#69f0ae'],
        ['#00bfff', '#1e90ff', '#63b3ed'],
        ['#bf00ff', '#9b59b6', '#c084fc'],
        ['#ff1493', '#ff69b4', '#ff9ff3'],
        ['#00ffff', '#00ced1', '#48dbfb'],
        ['#ff0000', '#cc0000', '#ffd700'],  // Êò•ËäÇÁ∫¢Èáë
        ['#fff', '#ffd700', '#ffec8b'],
    ];

    // ‚îÄ‚îÄ Stars ‚îÄ‚îÄ
    const stars = Array.from({length: 180}, () => ({
        x: Math.random() * innerWidth,
        y: Math.random() * innerHeight,
        s: Math.random() * 1.2,
        t: Math.random() * 6.28,
        v: rand(0.01, 0.025)
    }));

    function drawStars() {
        for (const s of stars) {
            s.t += s.v;
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.s, 0, 6.28);
            ctx.fillStyle = `rgba(255,255,255,${0.25 + Math.sin(s.t) * 0.25})`;
            ctx.fill();
        }
    }

    // ‚îÄ‚îÄ Particles ‚îÄ‚îÄ
    const particles = [];

    class Particle {
        constructor(x, y, angle, speed, color, decay, size) {
            this.x = x; this.y = y;
            this.vx = Math.cos(angle) * speed;
            this.vy = Math.sin(angle) * speed;
            this.color = color;
            this.alpha = 1;
            this.decay = decay || rand(0.008, 0.02);
            this.size = size || rand(1.5, 3);
            this.gravity = 0.035;
            this.friction = 0.985;
        }
        update() {
            this.vx *= this.friction;
            this.vy *= this.friction;
            this.vy += this.gravity;
            this.x += this.vx;
            this.y += this.vy;
            this.alpha -= this.decay;
            return this.alpha > 0;
        }
        draw() {
            ctx.globalAlpha = this.alpha;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size * this.alpha, 0, 6.28);
            ctx.fillStyle = this.color;
            ctx.shadowBlur = 8;
            ctx.shadowColor = this.color;
            ctx.fill();
            ctx.shadowBlur = 0;
            ctx.globalAlpha = 1;
        }
    }

    // ‚îÄ‚îÄ Rockets & Explosions ‚îÄ‚îÄ
    const rockets = [];
    const flashes = [];

    class Rocket {
        constructor(sx, tx, ty) {
            this.x = sx || rand(innerWidth * 0.15, innerWidth * 0.85);
            this.y = innerHeight + 5;
            this.tx = tx || this.x + rand(-40, 40);
            this.ty = ty || rand(innerHeight * 0.08, innerHeight * 0.4);
            const a = Math.atan2(this.ty - this.y, this.tx - this.x);
            const spd = rand(5.5, 8);
            this.vx = Math.cos(a) * spd;
            this.vy = Math.sin(a) * spd;
            this.palette = pick(palettes);
            this.trail = [];
            this.alive = true;
            playLaunch();
        }
        update() {
            this.trail.push({x: this.x, y: this.y, a: 1});
            if (this.trail.length > 15) this.trail.shift();
            this.x += this.vx;
            this.y += this.vy;
            // Spark trail
            if (Math.random() > 0.5) {
                particles.push(new Particle(this.x, this.y, rand(0, 6.28), rand(0.2, 0.6), '#ffd700', 0.05, rand(0.5, 1.2)));
            }
            if (Math.hypot(this.tx - this.x, this.ty - this.y) < 10 || this.y <= this.ty) {
                this.alive = false;
                this.explode();
            }
            this.trail.forEach(t => t.a -= 0.07);
        }
        explode() {
            const p = this.palette;
            const cx = this.x, cy = this.y;
            flashes.push({x: cx, y: cy, r: 5, mr: 120, a: 0.35, c: p[0]});
            playBoom();

            const type = Math.floor(rand(0, 5));
            switch (type) {
                case 0: { // Spherical
                    const n = Math.floor(rand(90, 160));
                    for (let i = 0; i < n; i++) {
                        const a = (6.28 / n) * i + rand(-0.1, 0.1);
                        particles.push(new Particle(cx, cy, a, rand(1.5, 5.5), pick(p)));
                    }
                    break;
                }
                case 1: { // Chrysanthemum
                    for (let i = 0; i < 200; i++) {
                        const a = (6.28 / 200) * i;
                        const pp = new Particle(cx, cy, a, rand(1, 6), pick(p), rand(0.004, 0.011));
                        pp.gravity = 0.02;
                        particles.push(pp);
                    }
                    break;
                }
                case 2: { // Ring
                    for (let i = 0; i < 80; i++) {
                        const a = (6.28 / 80) * i;
                        particles.push(new Particle(cx, cy, a, rand(3.5, 4.5), pick(p)));
                    }
                    break;
                }
                case 3: { // Willow (gold droop)
                    for (let i = 0; i < 140; i++) {
                        const a = (6.28 / 140) * i + rand(-0.1, 0.1);
                        const pp = new Particle(cx, cy, a, rand(2, 5), '#ffd700', rand(0.003, 0.007));
                        pp.gravity = 0.055;
                        pp.size = rand(1, 2);
                        particles.push(pp);
                    }
                    break;
                }
                case 4: { // Palm
                    const br = Math.floor(rand(5, 8));
                    for (let b = 0; b < br; b++) {
                        const ba = (6.28 / br) * b;
                        for (let i = 0; i < 22; i++) {
                            const pp = new Particle(cx, cy, ba + rand(-0.12, 0.12), rand(2, 6), pick(p));
                            pp.gravity = 0.05;
                            particles.push(pp);
                        }
                    }
                    break;
                }
            }
        }
        draw() {
            for (const t of this.trail) {
                if (t.a <= 0) continue;
                ctx.beginPath();
                ctx.arc(t.x, t.y, 1.5, 0, 6.28);
                ctx.fillStyle = `rgba(255,220,100,${t.a * 0.5})`;
                ctx.fill();
            }
            ctx.beginPath();
            ctx.arc(this.x, this.y, 2.5, 0, 6.28);
            ctx.fillStyle = '#fff';
            ctx.shadowBlur = 12;
            ctx.shadowColor = '#ffd700';
            ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    // ‚îÄ‚îÄ Audio (Web Audio API ‚Äî no external files) ‚îÄ‚îÄ
    let audioCtx = null;
    let musicPlaying = false;
    let musicNodes = null;

    function initAudio() {
        if (!audioCtx) audioCtx = new (AudioContext || webkitAudioContext)();
    }

    function playLaunch() {
        if (!audioCtx) return;
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = 'sine';
        o.frequency.setValueAtTime(350, audioCtx.currentTime);
        o.frequency.exponentialRampToValueAtTime(1400, audioCtx.currentTime + 0.25);
        g.gain.setValueAtTime(0.06, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
        o.connect(g).connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + 0.3);
    }

    function playBoom() {
        if (!audioCtx) return;
        const n = audioCtx.sampleRate * 0.25;
        const buf = audioCtx.createBuffer(1, n, audioCtx.sampleRate);
        const d = buf.getChannelData(0);
        for (let i = 0; i < n; i++) d[i] = (Math.random() * 2 - 1) * Math.exp(-i / (n * 0.12));
        const s = audioCtx.createBufferSource();
        s.buffer = buf;
        const f = audioCtx.createBiquadFilter();
        f.type = 'lowpass'; f.frequency.value = 600;
        const g = audioCtx.createGain();
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.35);
        s.connect(f).connect(g).connect(audioCtx.destination);
        s.start();
    }

    // Simple pentatonic melody loop (Êò•ËäÇÈ£éÊ†º)
    function startMusic() {
        if (!audioCtx || musicPlaying) return;
        musicPlaying = true;

        const masterGain = audioCtx.createGain();
        masterGain.gain.value = 0.08;
        masterGain.connect(audioCtx.destination);

        // Pentatonic scale notes (C D E G A) in different octaves
        const notes = [
            523.25, 587.33, 659.25, 783.99, 880.00,  // C5 D5 E5 G5 A5
            1046.50, 880.00, 783.99, 659.25, 587.33,  // C6 A5 G5 E5 D5
            523.25, 659.25, 783.99, 880.00, 783.99,   // C5 E5 G5 A5 G5
            659.25, 523.25, 587.33, 523.25, 440.00,   // E5 C5 D5 C5 A4
        ];
        const durations = [
            0.3, 0.3, 0.3, 0.3, 0.6,
            0.3, 0.3, 0.3, 0.3, 0.6,
            0.3, 0.3, 0.3, 0.3, 0.6,
            0.3, 0.3, 0.3, 0.3, 0.8,
        ];

        let noteIndex = 0;
        let scheduledTime = audioCtx.currentTime + 0.5;

        function scheduleChunk() {
            if (!musicPlaying) return;
            const chunkEnd = audioCtx.currentTime + 4;
            while (scheduledTime < chunkEnd) {
                const freq = notes[noteIndex % notes.length];
                const dur = durations[noteIndex % durations.length];

                const osc = audioCtx.createOscillator();
                const env = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.value = freq;
                env.gain.setValueAtTime(0.001, scheduledTime);
                env.gain.exponentialRampToValueAtTime(1, scheduledTime + 0.03);
                env.gain.exponentialRampToValueAtTime(0.001, scheduledTime + dur * 0.9);
                osc.connect(env).connect(masterGain);
                osc.start(scheduledTime);
                osc.stop(scheduledTime + dur);

                scheduledTime += dur;
                noteIndex++;
            }
            musicNodes.timer = setTimeout(scheduleChunk, 2000);
        }

        musicNodes = { masterGain, timer: null };
        scheduleChunk();
    }

    function stopMusic() {
        musicPlaying = false;
        if (musicNodes) {
            clearTimeout(musicNodes.timer);
            musicNodes.masterGain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);
            musicNodes = null;
        }
    }

    const musicBtn = document.getElementById('music-btn');
    musicBtn.addEventListener('click', () => {
        initAudio();
        if (musicPlaying) {
            stopMusic();
            musicBtn.textContent = 'üîá';
        } else {
            startMusic();
            musicBtn.textContent = 'üéµ';
        }
    });

    // ‚îÄ‚îÄ Click/tap to launch ‚îÄ‚îÄ
    canvas.addEventListener('click', e => {
        initAudio();
        const n = Math.floor(rand(2, 5));
        for (let i = 0; i < n; i++) {
            rockets.push(new Rocket(
                rand(innerWidth * 0.2, innerWidth * 0.8),
                e.clientX + rand(-60, 60),
                e.clientY + rand(-40, 40)
            ));
        }
    });
    canvas.addEventListener('touchstart', e => {
        e.preventDefault();
        initAudio();
        for (const t of e.touches) {
            const n = Math.floor(rand(2, 4));
            for (let i = 0; i < n; i++) {
                rockets.push(new Rocket(
                    rand(innerWidth * 0.2, innerWidth * 0.8),
                    t.clientX + rand(-60, 60),
                    t.clientY + rand(-40, 40)
                ));
            }
        }
    });

    // ‚îÄ‚îÄ Auto-launch ‚îÄ‚îÄ
    let lastLaunch = 0, interval = 600;
    let burstMode = false, burstTimer = 0;
    setInterval(() => { burstMode = true; burstTimer = 50; }, 10000);

    // ‚îÄ‚îÄ Main loop ‚îÄ‚îÄ
    function animate(ts) {
        // Fade sky
        const g = ctx.createLinearGradient(0, 0, 0, canvas.height);
        g.addColorStop(0, 'rgba(10, 0, 21, 0.22)');
        g.addColorStop(1, 'rgba(5, 0, 12, 0.22)');
        ctx.fillStyle = g;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        drawStars();

        // Flashes
        for (let i = flashes.length - 1; i >= 0; i--) {
            const f = flashes[i];
            f.r += (f.mr - f.r) * 0.1;
            f.a *= 0.9;
            if (f.a < 0.01) { flashes.splice(i, 1); continue; }
            ctx.globalAlpha = f.a * 0.25;
            ctx.beginPath();
            ctx.arc(f.x, f.y, f.r, 0, 6.28);
            ctx.fillStyle = f.c;
            ctx.fill();
            ctx.globalAlpha = 1;
        }

        // Auto-launch
        if (burstMode) {
            burstTimer--;
            if (burstTimer <= 0) burstMode = false;
            if (ts - lastLaunch > 90) {
                for (let i = 0; i < Math.floor(rand(2, 4)); i++) rockets.push(new Rocket());
                lastLaunch = ts;
            }
        } else if (ts - lastLaunch > interval) {
            for (let i = 0; i < Math.floor(rand(1, 3)); i++) rockets.push(new Rocket());
            lastLaunch = ts;
            interval = rand(400, 900);
        }

        // Rockets
        for (let i = rockets.length - 1; i >= 0; i--) {
            rockets[i].update();
            rockets[i].draw();
            if (!rockets[i].alive) rockets.splice(i, 1);
        }

        // Particles
        for (let i = particles.length - 1; i >= 0; i--) {
            if (!particles[i].update()) { particles.splice(i, 1); continue; }
            particles[i].draw();
        }

        requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
    </script>
</body>
</html>
